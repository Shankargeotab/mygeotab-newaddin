/* manifest.json */
{
  "name": "Plow Status Add-in",
  "version": "1.0",
  "description": "Displays Aux 6 as Plow Status in MyGeotab Map UI",
  "url": "https://shankargeotab.github.io/mygeotab-newaddin/index.html",
  "allowAnonymous": false
}

/* index.html */
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plow Status Add-in</title>
    <script src="index.js"></script>
</head>
<body>
    <h1>Plow Status</h1>
    <button onclick="updatePlowStatus()">Check Plow Status</button>
    <p id="status">Loading...</p>
</body>
</html>

/* index.js */
window.geotab.addin.plowStatus = (api, state) => {
    console.log("Plow Status Add-in Loaded");

    window.updatePlowStatus = async function () {
        try {
            const data = await api.call("GetFeed", {
                typeName: "StatusData",
                search: {
                    diagnosticSearch: { id: "Aux6" },
                    deviceSearch: { id: state.device.id }
                }
            });
            
            const status = data.data.length > 0 && data.data[0].value === 1 ? "Plow is Active" : "Plow is Inactive";
            document.getElementById("status").innerText = status;
        } catch (error) {
            console.error("Error fetching plow status:", error);
        }
    };
};
